{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block content %}
<div class="row my-3 p-3">
    <img class="rounded-circle account-img" src="{{ user.profile.avatar.url }} " style="cursor: pointer;"/>
</div>
<div class="content-section col-lg-12 col-md-12 col-sm-12 tutorial-style" style="min-height:65vh;">
    <legend class="border-bottom mb-4">Profile Information:</legend>
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="media">
            <div class="media-body">
                <h2 class="account-heading">{{ form.instance.username }}
                    <!-- <small class="text-muted">({{ form.instance.status }})</small> -->
                </h2>
                <p class="text-secondary">{{ form.instance.first_name }} {{ form.instance.last_name }}</p>
                <p class="text-secondary">{{ form.instance.email }}</p>
                <p class="text-secondary">{{ form.instance.bio }}</p>
            </div>
        </div>

        <h3 class="mt-5">Статьи пользователя:</h3>
        <div class="mb-5">
            {% include 'partial/article_list.html' %}
        </div>

        <fieldset class="form-group">
            <legend class="border-bottom mb-4">Calendar Slots</legend>
            <!-- Display existing slots -->
            <h4>Existing Slots:</h4>
            <ul id="existing-slots">
                <!-- Use JavaScript or AJAX to populate this list with existing slots -->
            </ul>
        
            <!-- Create new slot form -->
            <h4>Create a New Slot:</h4>
            <form id="create-slot-form">
                {% csrf_token %}
                <label for="start-time">Start Time:</label>
                <input type="datetime-local" id="start-time" name="start_time">
                <button type="button" onclick="createSlot()">Create Slot</button>
            </form>
        
            <!-- Add JavaScript code to handle displaying existing slots and creating new slots -->
            <script>
                // Function to retrieve and display existing slots
                function displayExistingSlots() {
                    // Make an AJAX request to the API endpoint for retrieving available slots
                    // Update the 'existing-slots' list with the response data
                }
        
                // Function to create a new slot
                function createSlot() {
                    // Retrieve the start time from the 'start-time' input field
                    // Make an AJAX request to the API endpoint for creating a slot
                    // Handle the response, such as displaying an error message or updating the UI
                    // Refresh the existing slots display to show the newly created slot
                }
        
                // Call the 'displayExistingSlots' function when the page loads to show the existing slots
                window.onload = displayExistingSlots;
            </script>
    </fieldset>

        {% if user.username == form.instance.username %}
            <fieldset class="form-group">
                <legend class="border-bottom mb-4">Edit Profile Information</legend>
                <div class="form-row">
                    <div class="form-group col-md-6 mb-0">
                        {{ form.first_name|as_crispy_field }}
                    </div>
                    <div class="form-group col-md-6 mb-0">
                        {{ form.last_name|as_crispy_field }}
                    </div>
                </div> 

                {{ form.bio|as_crispy_field }}

                <a href="{% url 'password_change' %}">Change password?</a>
            </fieldset>
            <div class="form-group">
                <button class="btn btn-outline-info" type="submit">Update</button>
            </div>

        

        {% endif %}
    </form>

</div>
{% endblock content %}